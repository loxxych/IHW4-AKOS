# Многопоточное моделирование клиники (уровень 8 баллов)

## Отчёт
- Исполнитель: *указать фамилию, имя, отчество и группу*.
- Вариант: «Задача о больнице» (уровень 8 баллов).

### Сценарий предметной области
Рабочий день клиники описывается ролями из условия задачи:
- Пациенты приходят с заданными или случайно сгенерированными интервалами и занимают очередь к дежурным врачам.
- Два дежурных врача по одному принимают пациентов, беседуют с ними и выбирают специалиста (стоматолог, хирург или терапевт).
- Каждый узкий специалист работает только с одним пациентом одновременно, остальные ждут в собственной очереди.
- Пациенты не покидают очереди самопроизвольно и уходят лишь после завершения лечения.

### Модель параллельных вычислений
- Каждого пациента, дежурного врача и узкого специалиста представляет отдельный POSIX-поток.
- Для синхронизации используются только мьютексы и семафоры (`pthread_mutex_t`, `sem_t`).
- Очереди пациентов реализованы как разделяемые циклические буферы, защищённые мьютексами; наличие заявок отражается счётными семафорами.
- Дежурные врачи маршрутизируют пациентов к специалистам, специалисты обслуживают полученные задачи.

### Входные данные и генерация случайных параметров
Параметры передаются через аргументы командной строки c обязательным ключом `--output`:
- Явный режим: `./clinic_io --output out.txt <patients> <arrival_min> <arrival_max> <triage_min> <triage_max> <treat_min> <treat_max>`.
- Режим конфигурационного файла: `./clinic_io --output out.txt --config config.txt`, где `config.txt` содержит 7 целых чисел (через пробел/перевод строки) в порядке: количество пациентов, интервалы прихода, беседы и лечения.
- Случайный режим: `./clinic_io --output out.txt --random-config [--seed N]` генерирует допустимые интервалы и количество пациентов (3–15).
- Во всех режимах можно задать `--seed N` для детерминированного воспроизведения.

### Генераторы случайных чисел
- Используется `rand()` с инициализацией `srand(seed)`, где `seed` берётся из `--seed` или из текущего времени.
- Случайные величины равномерны в включительно заданных диапазонах: время прихода пациента, длительность беседы у дежурного врача, длительность лечения у специалиста, направление пациента к одному из трёх специалистов (равновероятно).
- При выборе `--random-config` сами диапазоны параметров и количество пациентов тоже генерируются внутри допустимых пределов (описаны в исходном коде).

### Отображение событий и вывод в файл
- Все ключевые события выводятся в консоль и параллельно записываются в файл, заданный параметром `--output`.
- В случае `SIGINT` (`Ctrl+C`) выводится уведомление в оба потока вывода, после чего симуляция корректно завершает текущие приёмы.

### Завершение работы
- После получения `SIGINT` приложение фиксирует запрос на остановку, не принимает новых пациентов и корректно завершает текущие приёмы, выводя финальные сообщения.

## Сборка и запуск
```bash
cd clinic_io
make
./clinic_io --output sample_outputs/from_cli.txt 5 0 200 50 150 200 400
./clinic_io --output sample_outputs/from_file.txt --config configs/compact.txt --seed 7
./clinic_io --output sample_outputs/randomized.txt --random-config --seed 42
```

## Формат конфигурационного файла
Содержит семь целых чисел, разделённых пробелами или переводами строк:
```
<patients> <arrival_min> <arrival_max> <triage_min> <triage_max> <treat_min> <treat_max>
```

## Подготовленные примеры
- `configs/compact.txt`, `configs/slow.txt`, `configs/mixed.txt` — различные наборы входных данных.
- `sample_outputs/from_file.txt`, `sample_outputs/from_cli.txt`, `sample_outputs/randomized.txt` — результаты работы программы с указанными выше командами.

## Файлы проекта
- `main.c` — исходный код консольного приложения.
- `Makefile` — цели для сборки бинарного файла `clinic_io` и очистки артефактов.
- `configs/` — примеры конфигурационных файлов.
- `sample_outputs/` — сохранённые журналы работы для трёх разных запусков.
